class CreateSocialiteIdentities < ActiveRecord::Migration
  def up
    create_table :<%= options[:identity_table] %> do |t|
      t.string :uid, :provider
      t.integer <%= "#{options[:users_table]}_id".to_sym %>
      t.timestamps
    end

    add_index <%= options[:identity_table].to_sym %>,
      <%= "#{options[:users_table]}_id".to_sym %>

    # Restrict each user to one identity per provider, to disable comment out.
    add_index <%= options[:identity_table].to_sym %>,
      [<%= "#{options[:users_table]}_id".to_sym %>, :provider], :unique => true

    # Database constraint to ensure uniqueness of UIDs (scoped to provider)
    add_index <%= options[:identity_table].to_sym %>,
      [:provider, :uid], :unique => true
  end

  def down
    drop_table :<%= options[:identity_table] %>
  end
end
